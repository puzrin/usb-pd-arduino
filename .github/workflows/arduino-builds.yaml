name: Arduino Builds

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:
          - board: STMicroelectronics:stm32:Nucleo_32
            board_options: pnum=NUCLEO_G431KB
          - board: STMicroelectronics:stm32:Nucleo_64
            board_options: pnum=NUCLEO_G071RB
          - board: STMicroelectronics:stm32:Nucleo_64
            board_options: pnum=NUCLEO_G474RE
          - board: esp32:esp32:esp32s3
            board_options: ''

    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Install arduino-cli
        run: curl -fsSL https://raw.githubusercontent.com/arduino/arduino-cli/master/install.sh | BINDIR=/usr/local/bin sh
      - name: Install STM32 core
        run: arduino-cli core install STMicroelectronics:stm32 --additional-urls 'https://github.com/stm32duino/BoardManagerFiles/raw/main/package_stmicroelectronics_index.json'
        if: ${{ startsWith(matrix.board, 'STM') }}
      - name: Install ESP32 core
        run: arduino-cli core install esp32:esp32 --additional-urls 'https://espressif.github.io/arduino-esp32/package_esp32_index.json'
        if: ${{ startsWith(matrix.board, 'esp32') }}
      - name: Build ListCapabilities
        run: arduino-cli compile --library . --warnings all -b ${{ matrix.board }} --board-options "${{ matrix.board_options }}" examples/ListCapabilities/ListCapabilities.ino
      - name: Build TriggerBoard
        run: arduino-cli compile --library . --warnings all -b ${{ matrix.board }} --board-options "${{ matrix.board_options }}" examples/TriggerBoard/TriggerBoard.ino
      - name: Build TriggerBoardAdvanced
        run: arduino-cli compile --library . --warnings all -b ${{ matrix.board }} --board-options "${{ matrix.board_options }}" examples/TriggerBoardAdvanced/TriggerBoardAdvanced.ino
